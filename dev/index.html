<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · CALCEPH.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>CALCEPH.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>Tutorial</a><ul class="internal"><li><a class="toctext" href="#Ephemerides-sources-1">Ephemerides sources</a></li><li><a class="toctext" href="#Ephemerides-context-1">Ephemerides context</a></li><li><a class="toctext" href="#Epoch-arguments-1">Epoch arguments</a></li><li><a class="toctext" href="#Options-1">Options</a></li><li><a class="toctext" href="#Body-identification-scheme-1">Body identification scheme</a></li><li><a class="toctext" href="#NAIF-body-identification-scheme-1">NAIF body identification scheme</a></li><li><a class="toctext" href="#Computing-positions-and-velocities:-1">Computing positions and velocities:</a></li><li><a class="toctext" href="#Computing-orientation:-1">Computing orientation:</a></li><li><a class="toctext" href="#Computing-angular-momentum:-1">Computing angular momentum:</a></li><li><a class="toctext" href="#Time-ephemeris-1">Time ephemeris</a></li><li><a class="toctext" href="#In-place-methods-1">In place methods</a></li><li><a class="toctext" href="#Constants-1">Constants</a></li><li><a class="toctext" href="#Introspection-1">Introspection</a></li><li><a class="toctext" href="#Cleaning-up-1">Cleaning up</a></li><li><a class="toctext" href="#Error-handling-1">Error handling</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Tutorial</a></li></ul><a class="edit-page" href="https://github.com/JuliaAstro/CALCEPH.jl/blob/master/docs/src/index.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Tutorial</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Tutorial-1" href="#Tutorial-1">Tutorial</a></h1><p>This tutorial will walk you through the features and functionality of <a href="https://github.com/JuliaAstro/CALCEPH.jl">CALCEPH.jl</a></p><h2><a class="nav-anchor" id="Ephemerides-sources-1" href="#Ephemerides-sources-1">Ephemerides sources</a></h2><p>The supported sources of ephemerides are:</p><ul><li>JPL DExxx binary ephemerides files: <a href="https://ssd.jpl.nasa.gov/?planet_eph_export">https://ssd.jpl.nasa.gov/?planet<em>eph</em>export</a></li><li>IMCCE INPOP ephemerides files: <a href="https://www.imcce.fr/inpop/">https://www.imcce.fr/inpop/</a></li><li>some NAIF SPICE kernels: <a href="https://naif.jpl.nasa.gov/naif/data.html">https://naif.jpl.nasa.gov/naif/data.html</a></li></ul><p>Example:</p><pre><code class="language-julia">download(&quot;https://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/planets/de435.bsp&quot;,&quot;planets.dat&quot;)
# WARNING this next file is huge (Jupiter Moons ephemerides)
download(&quot;https://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/satellites/jup310.bsp&quot;,&quot;jupiter_system.bsp&quot;)</code></pre><h2><a class="nav-anchor" id="Ephemerides-context-1" href="#Ephemerides-context-1">Ephemerides context</a></h2><p>The user first need to load the ephemerides files into an ephemerides context object that will be used later to retrieve position and velocities of celestial objects.</p><p>A context can be made from one or several files:</p><pre><code class="language-julia">using CALCEPH

# load a single file in context eph1
eph1 = Ephem(&quot;planets.dat&quot;)

eph2 = Ephem([&quot;planets.dat&quot;,&quot;jupiter_system.bsp&quot;])</code></pre><p>You must specify the relative or absolute path(s) of the file(s) to load.</p><p>You can prefetch the ephemerides data into main memory for faster access:</p><pre><code class="language-julia">prefetch(eph2)</code></pre><h2><a class="nav-anchor" id="Epoch-arguments-1" href="#Epoch-arguments-1">Epoch arguments</a></h2><p>CALCEPH function takes the epoch as the sum of two double precision floating arguments jd1 and jd2. The sum jd1 + jd2 is interpreted as the julian date in the timescale of the ephemerides context (usually TDB or sometimes TCB).</p><p>For maximum accuracy, it is recommended to set jd2 to the fractional part of the julian date and jd1 to the difference: jd2 magnitude should be less than one while jd1 should have an integer value.</p><p>If a high accuracy in timetag is not needed, jd1 can be set to the full julian date and jd2 to zero.</p><h2><a class="nav-anchor" id="Options-1" href="#Options-1">Options</a></h2><p>Many CALCEPH function takes an integer argument to store options. The value of this argument is the sum of the option to enable (each option actually corresponds to a single bit of that integer). Each option to enable can appear only once in the sum!</p><p>The following options are available:</p><ul><li>unitAU = 1: set distance units it to Astronomical Unit.</li><li>unitKM = 2: set distance units to kilometers.</li><li>unitDay = 4: set time units to days.</li><li>unitSec = 8: set time units to seconds.</li><li>unitRad = 16: set angle units to radians.</li><li>useNaifId = 32: set the body identification scheme to NAIF body identification scheme.</li><li>outputEulerAngles = 64: when using body orientation ephemerides, this allows to choose Euler angle output.</li><li>outputNutationAngles = 128: when using body orientation ephemerides, this allows to choose nutation angle output (if available).</li></ul><p>The useNaifId option controls the identification scheme for the input arguments: target and center.</p><p>The units options controls the units of the outputs. It is compulsory to set the output units if the routine has the input argument options.</p><p>For example to compute the position and velocity in kilometers and kilometers per second of body target (given as its NAIF identification number) with respect to center (given as its NAIF identification number), the options argument should be set as such:</p><pre><code class="language-julia">options = unitKM + unitSec + useNaifId</code></pre><h2><a class="nav-anchor" id="Body-identification-scheme-1" href="#Body-identification-scheme-1">Body identification scheme</a></h2><p>CALCEPH has the following identification scheme for bodies:</p><ul><li>1 : Mercury Barycenter</li><li>2 : Venus Barycenter</li><li>3 : Earth</li><li>4 : Mars Barycenter</li><li>5 : Jupiter Barycenter</li><li>6 : Saturn Barycenter</li><li>7 : Uranus Barycenter</li><li>8 : Neptune Barycenter</li><li>9 : Pluto Barycenter</li><li>10 : Moon</li><li>11 : Sun</li><li>12 : Solar Sytem barycenter</li><li>13 : Earth-moon barycenter</li><li>14 : Nutation angles</li><li>15 : Librations</li><li>16 : difference TT-TDB</li><li>17 : difference TCG-TCB</li><li>asteroid number + 2000000 : asteroid</li></ul><p>If target is 14, 15, 16 or 17 (nutation, libration, TT-TDB or TCG-TCB), center must be 0.</p><p>The more complete NAIF identification scheme can be used if the value useNaifId is added to the options argument.</p><h2><a class="nav-anchor" id="NAIF-body-identification-scheme-1" href="#NAIF-body-identification-scheme-1">NAIF body identification scheme</a></h2><p>See <a href="https://naif.jpl.nasa.gov/pub/naif/toolkit_docs/C/req/naif_ids.html">https://naif.jpl.nasa.gov/pub/naif/toolkit<em>docs/C/req/naif</em>ids.html</a></p><p>CALCEPH uses this identification scheme only when the value useNaifId is added to the options argument.</p><p>The CALCEPH julia wrapper comes with the naifId object which contains the mapping between NAIF identification numbers and names:</p><pre><code class="language-julia">julia&gt; naifId.id[:sun]
10

julia&gt; naifId.id[:mars]
499

julia&gt; naifId.names[0]
Set(Symbol[:ssb, :solar_system_barycenter])
</code></pre><p>naifId also stores the following identifiers:</p><ul><li>:timecenter (1000000000): the center argument when requesting a value from a time ephemeris.</li><li>:ttmtdb (1000000001): the target argument when requesting a value from the difference TT-TDB time ephemeris.</li><li>:tcgmtcb (1000000002): the target argument when requesting a value from the difference TCG-TCB time ephemeris.</li></ul><p>naifId is actually an instance of mutable struct BodyId. The user can also create its own identification scheme for its SPICE kernels:</p><pre><code class="language-julia">const MyUniverseIds = CALCEPH.BodyId()
CALCEPH.add!(MyUniverseIds,:tatooine,1000001)
CALCEPH.add!(MyUniverseIds,:dagobah,1000002)
CALCEPH.add!(MyUniverseIds,:endor,1000003)
CALCEPH.add!(MyUniverseIds,:deathstar,1000004)
CALCEPH.add!(MyUniverseIds,:endor_deathstar_system_barycenter,1000005)
CALCEPH.add!(MyUniverseIds,:edsb,1000005)</code></pre><p>You can also load identification data from an external file:</p><pre><code class="language-julia">loadData!(MyUniverseIds, &quot;MyUniverseIds.txt&quot;))</code></pre><p>See example: <a href="https://github.com/JuliaAstro/CALCEPH.jl/blob/master/data/NaifIds.txt">https://github.com/JuliaAstro/CALCEPH.jl/blob/master/data/NaifIds.txt</a></p><p>Names from the file are converted to lower case and have spaces replaced by underscores before being converted to symbols/interned strings.</p><h2><a class="nav-anchor" id="Computing-positions-and-velocities:-1" href="#Computing-positions-and-velocities:-1">Computing positions and velocities:</a></h2><p>The following methods are available to compute position and velocity with CALCEPH:</p><pre><code class="language-julia">compute(eph,jd1,jd2,target,center)
compute(eph,jd1,jd2,target,center,options)
compute(eph,jd1,jd2,target,center,options,order)</code></pre><p>Those methods compute the position and its time derivatives of target with respect to center.</p><ul><li>The first argument eph is the ephemerides context.</li><li>The second and third arguments jd1 and jd2 are the epoch.</li><li>The third argument target is the body for which position is to be computed with respect to origin.</li><li>The fourth argument center is the origin.</li><li>The options argument shall specify the units. It can also be used to switch target and center numbering scheme to the NAIF identification scheme.</li><li>The order argument can be set to:<ul><li>0: compute position only</li><li>1: compute position and velocity</li><li>2: compute position, velocity and acceleration</li><li>3: compute position, velocity, acceleration and jerk.</li></ul></li></ul><p>When order is not specified, position and velocity are computed.</p><h4><a class="nav-anchor" id="Example:-1" href="#Example:-1">Example:</a></h4><p>Computing position only of Jupiter system barycenter with respect to the Earth Moon center in kilometers at JD=2456293.5 (Ephemeris Time).</p><pre><code class="language-julia">options = useNaifId + unitKM + unitSec
jd1 = 2456293.0
jd2 = 0.5
center = naifId.id[:moon]
target = naifId.id[:jupiter_barycenter]
pos = compute(eph2, jd1, jd2, target, center, options,0)</code></pre><h2><a class="nav-anchor" id="Computing-orientation:-1" href="#Computing-orientation:-1">Computing orientation:</a></h2><p>The following methods are available to compute orientation angles with CALCEPH:</p><pre><code class="language-julia">orient(eph,jd1,jd2,target,options)
orient(eph,jd1,jd2,target,options,order)</code></pre><p>Those methods compute the Euler angles of target and their time derivatives.</p><ul><li>The first argument eph is the ephemerides context.</li><li>The second and third arguments jd1 and jd2 are the epoch.</li><li>The fourth argument target is the body for which the Euler angles are to be computed.</li><li>The options argument shall specify the units. It can also be used to switch target and center numbering scheme to the NAIF identification scheme and to switch between Euler angles and nutation angles.</li><li>The order argument can be set to:<ul><li>0: only the angles are computed.</li><li>1: only the angles and first derivatives are computed.</li><li>2: only the angles, the first and second derivatives are computed.</li><li>3: the angles, the first, second and third derivatives are computed.</li></ul></li></ul><h4><a class="nav-anchor" id="Example:-2" href="#Example:-2">Example:</a></h4><p>JPL DE405 binary ephemerides contain Chebychev polynomials for the IAU 1980 nutation theory. Interpolating those is much faster than computing the IAU 1980 nutation series.     Computing Earth nutation angles in radians at JD=2456293.5 (Ephemeris Time).</p><pre><code class="language-julia">download(&quot;ftp://ssd.jpl.nasa.gov/pub/eph/planets/Linux/de405/lnxp1600p2200.405&quot;,&quot;DE405&quot;)
eph1 = Ephem(&quot;DE405&quot;)
options = useNaifId + unitRad + unitSec + outputEulerAngles
jd1 = 2456293.0
jd2 = 0.5
target = naifId.id[:earth]
angles = orient(eph1, jd1, jd2, target, options,0)</code></pre><p>Note that the returned value is a vector of 3 even though there are only 2 nutation angles. The last value is zero and meaningless.</p><h2><a class="nav-anchor" id="Computing-angular-momentum:-1" href="#Computing-angular-momentum:-1">Computing angular momentum:</a></h2><p>The following methods are available to compute body angular momentum with CALCEPH:</p><pre><code class="language-julia">rotAngMom(eph,jd1,jd2,target,unit)
rotAngMom(eph,jd1,jd2,target,unit,order)</code></pre><p>Those methods compute the angular momentum of target and their time derivatives.</p><ul><li>The first argument eph is the ephemerides context.</li><li>The second and third arguments jd1 and jd2 are the epoch.</li><li>The fourth argument target is the body for which the angular momentum are to be computed.</li><li>The options argument shall specify the units. It can also be used to switch target numbering scheme to the NAIF identification scheme.</li><li>The order argument can be set to:<ul><li>0: only the angular momentum vector are computed.</li><li>1: only the angular momentum vector and first derivative are computed.</li><li>2: only the angular momentum vector, the first and second derivatives are computed.</li><li>3: the angular momentum, the first, second and third derivatives are computed.</li></ul></li></ul><h2><a class="nav-anchor" id="Time-ephemeris-1" href="#Time-ephemeris-1">Time ephemeris</a></h2><p>The time ephemeris TT-TDB or TCG-TCB at the geocenter can be evaluated with a suitable source.</p><p>INPOP and some JPL DE ephemerides includes a numerically integrated time ephemeris for the geocenter which is usually more accurate than the analytical series: Moreover it is much faster to interpolate those ephemerides than to evaluate the analytical series. This is only for the geocenter but a simple correction can also be added for the location of the observer (and its velocity in case the observer is on a highly elliptical orbit).</p><p>Files that can be used to obtain the difference between TT and TDB are, e.g.:</p><ul><li><a href="ftp://ftp.imcce.fr/pub/ephem/planets/inpop17a/inpop17a_TDB_m100_p100_tt.dat">ftp://ftp.imcce.fr/pub/ephem/planets/inpop17a/inpop17a<em>TDB</em>m100<em>p100</em>tt.dat</a></li><li><a href="ftp://ssd.jpl.nasa.gov/pub/eph/planets/bsp/de432t.bsp">ftp://ssd.jpl.nasa.gov/pub/eph/planets/bsp/de432t.bsp</a></li></ul><h4><a class="nav-anchor" id="Example:-3" href="#Example:-3">Example:</a></h4><p>Computing TT-TDB at geocenter in seconds at JD=2456293.5 (Ephemeris Time).</p><pre><code class="language-julia">download(&quot;ftp://ftp.imcce.fr/pub/ephem/planets/inpop17a/inpop17a_TDB_m100_p100_tt.dat&quot;,&quot;INPOP17a&quot;)
eph1 = Ephem(&quot;INPOP17a&quot;)
options = useNaifId + unitSec
jd1 = 2456293.0
jd2 = 0.5
target = naifId.id[:ttmtdb]
center = naifId.id[:timecenter]
ttmtdb = compute(eph1, jd1, jd2, target, center, options,0)</code></pre><p>Note that the returned value is a vector of 3 even though there is only one meaningful value. The last 2 values are zero and meaningless.</p><h2><a class="nav-anchor" id="In-place-methods-1" href="#In-place-methods-1">In place methods</a></h2><p>In place versions of the methods described above are also available. Those are:</p><pre><code class="language-julia">unsafe_compute!(result,eph,jd1,jd2,target,center)
unsafe_compute!(result,eph,jd1,jd2,target,center,options)
unsafe_compute!(result,eph,jd1,jd2,target,center,options,order)
unsafe_orient!(result,eph,jd1,jd2,target,options)
unsafe_orient!(result,eph,jd1,jd2,target,options,order)
unsafe_rotAngMom!(result,eph,jd1,jd2,target,options)
unsafe_rotAngMom!(result,eph,jd1,jd2,target,options,order)</code></pre><p>Those methods do not perform any checks on their inputs. In particular, result must be a contiguous vector of double precision floating point number of dimension at least 6 when order is not specified or at least 3*(order+1) otherwise.</p><h2><a class="nav-anchor" id="Constants-1" href="#Constants-1">Constants</a></h2><p>Ephemerides files may contain related constants. Those can be obtained by the <strong>constants</strong> method which returns a dictionary:</p><pre><code class="language-julia">download(&quot;ftp://ftp.imcce.fr/pub/ephem/planets/inpop17a/inpop17a_TDB_m100_p100_tt.dat&quot;,&quot;INPOP17a&quot;)
eph1 = Ephem(&quot;INPOP17a&quot;)
# retrieve constants from ephemeris as a dictionary
con = constants(eph1)
# list the constants
keys(con)
# get the sun J2
J2sun = con[:J2SUN]</code></pre><h2><a class="nav-anchor" id="Introspection-1" href="#Introspection-1">Introspection</a></h2><h4><a class="nav-anchor" id="Time-scale-1" href="#Time-scale-1">Time scale</a></h4><pre><code class="language-julia">timeScale(eph)</code></pre><p>returns the Ephemeris Time identifier:</p><ul><li>1 for TDB</li><li>2 for TCB</li></ul><h4><a class="nav-anchor" id="Time-span-1" href="#Time-span-1">Time span</a></h4><pre><code class="language-julia">timespan(eph)</code></pre><p>returns the triplet:</p><ul><li>julian date of first entry in ephemerides context.</li><li>julian date of last entry in ephemerides context.</li><li>information about the availability of the quantities over the time span:<ul><li>1 if the quantities of all bodies are available for any time between the first and last time.</li><li>2 if the quantities of some bodies are available on discontinuous time intervals between the first and last time.</li><li>3 if the quantities of each body are available on a continuous time interval between the first and last time, but not available for any time between the first and last time.</li></ul></li></ul><h4><a class="nav-anchor" id="Position-records-1" href="#Position-records-1">Position records</a></h4><pre><code class="language-julia">positionRecords(eph)</code></pre><p>retrieve position records metadata in ephemeris associated to handler eph. This is a vector of metadata about the ephemerides records ordered by priority. The compute methods use the highest priority ephemerides records when there are multiple records that could satisfy the target and epoch.</p><p>Each record metadata contains the following information:</p><ul><li>target: NAIF identifier of target.</li><li>center: NAIF identifier of center.</li><li>startEpoch: julian date of record start.</li><li>stopEpoch: julian date of record end.</li><li>frame : 1 for ICRF.</li></ul><h4><a class="nav-anchor" id="Orientation-records-1" href="#Orientation-records-1">Orientation records</a></h4><pre><code class="language-julia">orientationRecords(eph)</code></pre><p>retrieve orientation records metadata in ephemeris associated to handler eph. This is a vector of metadata about the ephemerides records ordered by priority. The orient methods use the highest priority ephemerides records when there are multiple records that could satisfy the target and epoch.</p><p>Each record metadata contains the following information:</p><ul><li>target: NAIF identifier of target.</li><li>startEpoch: julian date of record start.</li><li>stopEpoch: julian date of record end.</li><li>frame : 1 for ICRF.</li></ul><h2><a class="nav-anchor" id="Cleaning-up-1" href="#Cleaning-up-1">Cleaning up</a></h2><p>Because, Julia&#39;s garbage collector is lazy, you may want to free the memory managed by the context before you get rid of the reference to the context with eg:</p><pre><code class="language-julia">finalize(eph1)
eph1 = Nothing</code></pre><p>or after with</p><pre><code class="language-julia">eph1 = Nothing
gc()</code></pre><h2><a class="nav-anchor" id="Error-handling-1" href="#Error-handling-1">Error handling</a></h2><p>By default, the CALCEPH C library prints error messages directly to the standard output but this can be modified.</p><p>The Julia wrapper provides the following interface for this purpose:</p><pre><code class="language-julia">CALCEPH.setCustomHandler(f)</code></pre><p>where f should be a user function taking a single argument of type String which will contain the CALCEPH error message. f should return Nothing.</p><p>To disable CALCEPH error messages printout to the console:</p><pre><code class="language-julia">CALCEPH.setCustomHandler(s-&gt;Nothing)</code></pre><p>To get back the default behavior:</p><pre><code class="language-julia">CALCEPH.disableCustomHandler()</code></pre><footer><hr/></footer></article></body></html>
